#: import Widget uix.widgets
#: import RoundedButtonWithShadow uix.widgets
#: import BlueButton uix.widgets
#: import FontelloButton uix.widgets
#: import ScrollEffect kivy.effects.scroll.ScrollEffect

#: import __version__ bot.core.__version__


<TwoFAKeyEnterPopup>:
    size_hint_y: None
    height: content.height + dp(30)
    pos_hint: {'center_y': 0.7}

    GridLayout: # BoxLayout in future
        id: content
        cols: 1
        size_hint: None, None
        width: app.root_window.width - dp(20)
        height: self.minimum_height

        Label:
            text: 'Код для двухфакторной авторизации:'
            text_size: self.width, None
            font_size: sp(20)
            size_hint_y: None
            height: self.texture_size[1]

        BoxLayout:
            size_hint_y: None
            height: self.minimum_height

            Button:
                text: ' Вставить код '
                font_size: sp(20)
                size_hint_x: None
                width: self.texture_size[0]
                on_release: root.paste_twofa_code(code_textinput)

            TextInput:
                id: code_textinput
                multiline: False
                font_size: sp(40)
                size_hint_y: None
                height: self.minimum_height

            Button:
                text: '  Ввод  '
                font_size: sp(20)
                size_hint_x: None
                width: self.texture_size[0]
                on_release: root.twofa_auth(code_textinput.text)


<AuthScreen>:
    name: 'auth_screen'

    GridLayout:
        rows: 5
        spacing: dp(3)
        size_hint: None, None
        size: self.minimum_size
        pos_hint: {'center_x':.5,'center_y':.75}

        Label:
            text: 'Авторизация ВК'
            color: 0, .2, .4, 1
            font_size: '20sp'
            padding_y: dp(5)
            size_hint: None, None
            size: self.texture_size

        TextInput:
            hint_text: 'Логин'.decode('utf8')
            id: login_textinput
            size_hint: None, None
            font_size: '18sp'
            height: self.minimum_height
            width: self.height*8
            multiline: False

        TextInput:
            hint_text: 'Пароль'.decode('utf8')
            id: pass_textinput
            size_hint: None, None
            font_size: '18sp'
            height: self.minimum_height
            width: self.height*8
            multiline: False

        Button:
            id: show_pass_label
            text: root.hide_password_text
            background_color: 0, 0, 0, 0
            color: 0, .2, .4, 1
            font_size: '16sp'
            padding_y: dp(9)
            size_hint_y: None
            height: self.texture_size[1]
            on_release: root.update_pass_input_status(self)

        GridLayout:
            cols: 3
            size_hint_y: None
            size: self.minimum_size

            Widget

            BlueButton:
                id: enter
                text: 'Войти'
                font_size: '16sp'
                padding_y: dp(10)
                size_hint: 1.3, None
                height: self.texture_size[1]
                on_release: root.log_in()

            Widget

    RoundedButtonWithShadow:
        id: pass_auth
        text: 'Пропустить'
        font_size: '16sp'
        background_color: .2, .2, .2, 0
        size_hint: None, None
        size: self.texture_size[0]*2.3, self.texture_size[1]*2.3
        pos_hint: {'center_x':.5}
        pos: self.pos[0], root.height*.05        
        on_release: root.parent.show_main_screen()
        disabled: False


<InfoPopup>:
    size_hint: None, None
    size: content.width + dp(40), content.height + dp(50)

    Label:
        id: content
        size_hint: None, None
        size: self.texture_size
        markup: True
        text: 'VKBot версии %s\nГруппа в ВК: [color=#199ac1][ref=https://vk.com/foga_prod]vk.com/foga_prod[/ref][/color]\n\n[color=#199ac1][ref=https://github.com/Fogapod/VKBot/tree/0.1.0dev#Руководство-к-использованию]Открыть мануал[/ref][/color]' % __version__
        font_size: '18sp'
        on_ref_press: app._open_url(args)


<CaptchaPopup>:
    size_hint: None, None
    size: content.width + dp(40), content.height + dp(50)

    BoxLayout:
        id: content
        size_hint: None, None
        size: self.minimum_size
        orientation: 'vertical'
        spacing: dp(8)

        AsyncImage:
            id: image
            allow_stretch: True
            size_hint: None, None
            size: dp(260), dp(100)

        TextInput:
            id: textinput
            multiline: False
            size_hint_y: None
            height: self.minimum_height

        GridLayout:
            cols: 3
            size_hint: None, None
            size: image.width, self.minimum_height

            Button:
                text: ' Принять '
                font_size: '17sp'
                size_hint: None, None
                size: self.texture_size[0], self.texture_size[1]*2

                on_release: root.retry_request(textinput.text)

            Widget

            Button:
                text: ' Отмена '
                font_size: '17sp'
                size_hint: None, None
                size: self.texture_size[0], self.texture_size[1]*2
                on_release: root.dismiss()


<MainScreen>:
    name: 'main_screen'

    BoxLayout:
        orientation: 'vertical'

        ActionBar:
            ActionView:
                ActionPrevious:
                    id: actionprevious
                    app_icon: 'data/images/icon.png'

                ActionButton:
                    text: 'Мои команды'

                    on_release: root.parent.show_custom_commands_screen()

                ActionOverflow:
                    mode: 'spinner'

                    ActionButton:
                        text: '[Экспорт логов]'

                        on_release: app._export_logs()

                    ActionButton:
                        minimum_width: '125sp'
                        text: 'Настройки'

                        on_release: app.open_settings()

                    ActionButton:
                        text: 'Авторизация'

                        on_release: root.parent.show_auth_screen()

                    ActionButton:
                        text: 'Информация'

                        on_release: root.show_info()

                    ActionButton:
                        text: 'Выйти'

                        on_release: root.logout()

                    ActionButton:
                        text: 'Очистка лога'

                        on_release:
                            root.ids.logging_panel.text = root.ids.logging_panel.default_text

        GridLayout: # BoxLayout in future
            cols: 1
            padding: dp(20), dp(30)
            size_hint_y: None
            height: self.minimum_height

            BlueButton:
                id: main_btn
                font_size: '16sp'
                size_hint: 1, None

                on_release: root.on_main_btn_press()

        BoxLayout:
            padding: dp(4)

            canvas.before:
                Color:
                    rgb: .2, .2, .2
                Rectangle:
                    pos: self.pos
                    size: self.size

            BoxLayout:
                padding: dp(2)

                canvas.before:
                    Color:
                        rgb: 0, 0, 0

                    Rectangle:
                        pos: self.pos
                        size: self.size

                    Color:
                        rgb: .46, .46, .46

                    Rectangle:
                        pos:
                            self.pos[0] + self.padding[0]/2, self.pos[1] + self.padding[1]/2
                        size:
                            self.size[0] - self.padding[0], self.size[1] - self.padding[1]

                ScrollView:
                    effect_cls: ScrollEffect

                    Label:
                        id: logging_panel
                        default_text: '[b]Добро пожаловать в приложение [i]VKBot[/i] версии %s !\n[/b]'.decode('utf8') % __version__
                        text: self.default_text
                        text_size: self.width, None
                        color: 1, 1, 1, .8
                        font_name: 'Roboto' # TODO 'RobotoMono'
                        font_size: sp(12)
                        markup: True
                        padding: dp(2), dp(2)
                        size_hint_y: None
                        height: self.texture_size[1]


<CustomCommandsScreen>:
    name: 'cc_screen'

    BoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        spacing: dp(5)

        BoxLayout:
            padding: dp(4)

            canvas.before:
                Color:
                    rgb: 0, 0, 0

                Rectangle:
                    pos: self.pos
                    size: self.size

                Color:
                    rgb: .46, .46, .46

                Rectangle:
                    pos:
                        self.pos[0] + self.padding[0]/2, self.pos[1] + self.padding[1]/2
                    size:
                        self.size[0] - self.padding[0], self.size[1] - self.padding[1]

            ScrollView:
                effect_cls: ScrollEffect

                GridLayout: # BoxLayout in future
                    id: cc_list
                    cols: 1
                    spacing: dp(2)
                    size_hint_y: None
                    height: self.minimum_size[1]

        GridLayout:
            cols: 5
            size_hint_y: None
            height: self.minimum_height

            FontelloButton:
                text: 'P'
                size_hint_x: 1.5
                background_color: 0, 0, 0, 0

                on_release: root.open_new_command_popup()

            Widget

            BlueButton:
                text: 'Вернуться'
                size_hint: 1, None

                on_release: root.leave()

            Widget

            FontelloButton:
                text: 'U'
                size_hint_x: 1.5
                background_color: 0, 0, 0, 0

                on_release: root.sort_blocks()
